<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>flickr</title>

  <!-- Bootstrap -->
  <link href="css/bootstrap.min.css" rel="stylesheet">


  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body>
  <div class="container">
    <h1>flickr!</h1>
    <div class="input-append">
      <input name="search" id="search"/>
      <button class="btn btn-primary btn-sm" onclick="searchFlickr()">Search</button>
    </div>
    <br>
    <div class=content style="border-box: 8px">

    </div>
    <div id="results"></div>
  </div>
</body>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="./node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script>

function searchFlickr() {
  $(document).ready(function () {
    let search = $('input#search').val();
    var apiurl, myresult, apiurl_size, selected_size;
    // console.log(search);
    $.ajax({
      url: `https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=ca370d51a054836007519a00ff4ce59e&text=${search}&per_page=5&format=json&nojsoncallback=1`,
      method: 'GET',
      dataType: 'JSON',
      success: (dataPencarian) => {
        // console.log(dataPencarian.photos.photo[0].title);
          $.each(dataPencarian.photos.photo,function(i,myresult){
            // console.log(myresult.title);
            apiurl_size = "https://api.flickr.com/services/rest/?method=flickr.photos.getSizes&api_key=ca370d51a054836007519a00ff4ce59e&photo_id="+myresult.id+"&format=json&nojsoncallback=1";
            // console.log(apiurl_size);
            $.getJSON(apiurl_size,function(size){
              $.each(size.sizes.size,function(i,myresult_size){
                // console.log(myresult_size);
                if(myresult_size.width==500){
                  let data = `<p><a href="${myresult_size.url}" target="_blank"><img src="${myresult_size.source}"/></a><figcaption>${myresult.title}</figcaption></p>`
                  $("#results").prepend(data);
                }
              });
            });
          });
      },
      error: (err) => {
        console.log(err);
      }
    })
  });
}
</script>
</html>
